/**
 * NGS Module: analytics - v1.0.0
 * Description: Module for setting up Analytics on NGS projects
 * Date Built: 2013-11-06
 * Copyright (c) 2013  | National Geographic Society Technology;
**/
(function(){var a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};n=window.location.siteName=window.location.siteName||function(a){var b,c;for(b=a||window.location.hostname,b=b.replace(/^\w+?:\d*?\/\//,""),b=b.split("/")[0],b=b.split("."),c=b.length>=2?2===b[b.length-2].length?3:2:1;b.length>c;)b.shift();return b.join(".")},void 0===String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),d=!!window.location.search.match("debug"),k=function(a){return d&&window.console&&window.console.log?window.console.log(a):void 0},o=function(a){return window._gaq.push(a),k(a)},o.help="Usage: track(['_trackEvent', category, action, opt_label, opt_value, opt_noninteraction])",j=!!document.location.protocol.match("https:"),i=!!document.location.protocol.match("http:"),l=document.documentElement,f=function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},p=function(a,b,c){var d,f;return f=function(a){var d,e,f,g;for(e=b.nodeName||b===window||b===document?[b]:document.querySelectorAll(b),f=0,g=e.length;g>f;f++)if(d=e[f],a.currentTarget===d)return c.call(a.target,a)},d=b!==window?document:window,d.addEventListener?d.addEventListener(a,function(a){return f(a)},!1):d.attachEvent?(d.attachEvent("on"+a,function(){}),f(e)):void 0},c=function(a,b,c){var d;return l=document.documentElement,d=document.createElement("script"),"function"==typeof b&&p("load",d,b),d.src=a,d.async=void 0===c?!0:c,l.insertBefore(d,l.childNodes[0]),d},m={accountID:"UA-28236326-1",natGeoDomains:["nationalgeographicexpeditions.com","scienceblogs.com","buysub.com","ngtravelerseminars.com","greatenergychallengeblog.com","360energydiet.com","nationalgeographic.org","nationalgeographic.com","ngstudentexpeditions.com","natgeotakeaction.org","customersvc.com","killinglincolnconspiracy.com"],trackFirstNSearchItems:4,videoEvents:["canplay","playing","pause","progress","ended"],videoDurationMilestones:[0,25,50,75,100],scrollMilestones:[30,60,90]},g=function(a){var b,d,e,f,g,h,i,k,r,s,t,u,v,w,x,y,z,A;for(h in a)if("natGeoDomains"===h)for(z=a[h],x=0,y=z.length;y>x;x++)b=z[x],A=!b,q.call(m[h],A)>=0&&m[h].push(b);else m[h]=a[h];return window._gaq=window._gaq||[],o(["_setAccount",m.accountID]),o(["_setDomainName",n()]),o(["_setAllowLinker",!0]),o(["_addIgnoredRef","nationalgeographic"]),"function"==typeof onMMDBHeaderLoaded&&onMMDBHeaderLoaded(function(a){return a.isLoggedIn().done(function(b){var c,d,e;return b?(d=a.getUser(),c=d.attributes.memberLevel,e=d.attributes.userHash,o(["_setCustomVar",3,"isLoged","true",3]),o(["_setCustomVar",8,"userToken",e,3]),o(["_setCustomVar",9,"memberLevel",c,3])):o(["_setCustomVar",3,"isLoged","false",3]),a.onUserLoggedIn(function(){return o(["_trackEvent","Membership","General","Sign In"])}),a.onUserLoggedOut(function(){return o(["_trackEvent","Membership","General","Log Out"])})})}),c(""+(j?"https://ssl":"http://www")+".google-analytics.com/ga.js"),p("click","a[href*='//']:not([href*='"+n()+"'])",function(a){var b,c;return b=a.target,c=n(b.href),q.call(m.natGeoDomains,c)>=0?o(["_link",b.href]):o(["_trackEvent","engagement","outbound-click",b.title||n(b.href)])}),k=-1,s=m.videoDurationMilestones,i=s[s.length-1],e=!1,t=function(){return window.self.pageYOffset||l&&l.scrollTop||document.body.scrollTop},r=function(){return document.body.scrollHeight},w=function(){return window.self.innerHeight||l&&l.clientHeight||document.body.clientHeight},u=m.scrollMilestones.slice(),g=function(){var a,b,c;for(c=[],a=0,b=u.length;b>a;a++)f=u[a],c.push(!1);return c}(),p("scroll",window,function(){var a,b,c,d,e,f,h,i,j,k,l;for(d=(t()+w())/r(),e=t(),c=window.location.pathname,f=window.location.search,i=c+f,h=function(a,b){return o(["_trackEvent","engagement","scrolled past "+b,i]),g[a]=!0},l=[],a=j=0,k=u.length;k>j;a=++j)b=u[a],!g[a]&&e>b?l.push(h(a,b)):l.push(void 0);return l}),d=20,v=window.location.pathname+window.location.search,window.setTimeout(function(){return o(["_trackEvent","engagement","Dwell time (more than "+d+" seconds)",v])},1e3*d)},b=function(){return m.accountID},h=function(){return m.natGeoDomains},a=function(){function a(a){var b,c;null==a&&(a={}),this.name=null!=(b=a.name)?b:"",this.accountID=null!=(c=a.accountID)?c:m.a,g()}return a.prototype.track=o,a.prototype.upon=p,a.prototype.internalTrafficDomains=h,a.prototype.videoEvents=[].slice.call(m.videoEvents),a}(),window.Analytics=a}).call(this);