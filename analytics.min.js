/**
 * NGS Module: analytics - v1.0.0
 * Description: Module for setting up Analytics on NGS projects
 * Date Built: 2013-11-06
 * Copyright (c) 2013  | National Geographic Society Technology;
**/
(function(){var a,b,c,d,f,g,h,i,j,k,l,m,n,o,p=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};m=window.location.siteName=window.location.siteName||function(a){var b,c;for(b=a||window.location.hostname,b=b.replace(/^\w+?:\d*?\/\//,""),b=b.split("/")[0],b=b.split("."),c=b.length>=2?2===b[b.length-2].length?3:2:1;b.length>c;)b.shift();return b.join(".")},void 0===String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),c=!!window.location.search.match("debug"),j=function(a){return c&&window.console&&window.console.log?window.console.log(a):void 0},n=function(a){return window._gaq.push(a),j(a)},n.help="Usage: track(['_trackEvent', category, action, opt_label, opt_value, opt_noninteraction])",i=!!document.location.protocol.match("https:"),h=!!document.location.protocol.match("http:"),k=document.documentElement,d=function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},o=function(a,b,c){var d,f;return f=function(a){var d,e,f,g;for(e=b.nodeName||b===window||b===document?[b]:document.querySelectorAll(b),f=0,g=e.length;g>f;f++)if(d=e[f],a.currentTarget===d)return c.call(a.target,a)},d=b!==window?document:window,d.addEventListener?d.addEventListener(a,function(a){return f(a)},!1):d.attachEvent?(d.attachEvent("on"+a,function(){}),f(e)):void 0},b=function(a,b,c){var d;return k=document.documentElement,d=document.createElement("script"),"function"==typeof b&&o("load",d,b),d.src=a,d.async=void 0===c?!0:c,k.insertBefore(d,k.childNodes[0]),d},l={accountID:"UA-28236326-1",natGeoDomains:["nationalgeographicexpeditions.com","scienceblogs.com","buysub.com","ngtravelerseminars.com","greatenergychallengeblog.com","360energydiet.com","nationalgeographic.org","nationalgeographic.com","ngstudentexpeditions.com","natgeotakeaction.org","customersvc.com","killinglincolnconspiracy.com"],trackFirstNSearchItems:4,videoEvents:["canplay","playing","pause","progress","ended"],videoDurationMilestones:[0,25,50,75,100],scrollMilestones:[30,60,90]},f=function(a){var c,d,e,f,g,h,j,q,r,s,t,u,v,w,x;for(h in a)if("natGeoDomains"===h)for(w=a[h],u=0,v=w.length;v>u;u++)d=w[u],x=!d,p.call(l[h],x)>=0&&l[h].push(d);else l[h]=a[h];return window._gaq=window._gaq||[],n(["_setAccount",l.accountID]),n(["_setDomainName",m()]),n(["_setAllowLinker",!0]),n(["_addIgnoredRef","nationalgeographic"]),c=document.querySelector("body"),"function"==typeof onMMDBHeaderLoaded&&onMMDBHeaderLoaded(function(a){return a.isLoggedIn().done(function(b){var c,d,e;return b?(d=a.getUser(),c=d.attributes.memberLevel,e=d.attributes.userHash,n(["_setCustomVar",3,"isLoged","true",3]),n(["_setCustomVar",8,"userToken",e,3]),n(["_setCustomVar",9,"memberLevel",c,3])):n(["_setCustomVar",3,"isLoged","false",3]),a.onUserLoggedIn(function(){return n(["_trackEvent","Membership","General","Sign In"])}),a.onUserLoggedOut(function(){return n(["_trackEvent","Membership","General","Log Out"])})})}),b(""+(i?"https://ssl":"http://www")+".google-analytics.com/ga.js"),o("click","a[href*='//']:not([href*='"+m()+"'])",function(a){var b,c;return b=a.target,c=m(b.href),p.call(l.natGeoDomains,c)>=0?n(["_link",b.href]):n(["_trackEvent","engagement","outbound-click",b.title||m(b.href)])}),q=function(){return window.self.pageYOffset||k&&k.scrollTop||document.body.scrollTop},j=function(){return document.body.scrollHeight},t=function(){return window.self.innerHeight||k&&k.clientHeight||document.body.clientHeight},r=l.scrollMilestones.slice(),g=function(){var a,b,c;for(c=[],a=0,b=r.length;b>a;a++)f=r[a],c.push(!1);return c}(),o("scroll",window,function(){var a,b,c,d,e,f,h,i,k,l,m;for(d=(q()+t())/j(),e=q(),c=window.location.pathname,f=window.location.search,i=c+f,h=function(a,b){return n(["_trackEvent","engagement","scrolled past "+b,i]),g[a]=!0},m=[],a=k=0,l=r.length;l>k;a=++k)b=r[a],!g[a]&&e>b?m.push(h(a,b)):m.push(void 0);return m}),e=20,s=window.location.pathname+window.location.search,window.setTimeout(function(){return n(["_trackEvent","engagement","Dwell time (more than "+e+" seconds)",s])},1e3*e)},a=function(){return l.accountID},g=function(){return l.natGeoDomains},window.Analytics=function(){function a(a){var b,c;null==a&&(a={}),this.name=null!=(b=a.name)?b:"",this.accountID=null!=(c=a.accountID)?c:l.accountID,f(a)}return a.prototype.track=function(){return n(arguments[0].splice(1,""+this.name+"."+arguments[0]))},a.prototype.upon=o,a.prototype.internalTrafficDomains=g,a.prototype.videoEvents=[].slice.call(l.videoEvents),a}()}).call(this);