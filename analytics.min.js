/**
 * NGS Module: analytics - v1.0.0
 * Description: Module for setting up Analytics on NGS projects
 * Date Built: 2013-11-03
 * Copyright (c) 2013  | National Geographic Society Technology;
**/
(function(){var a,b,c,d,f,g,h,i,j,k,l,m,n,o=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};l=window.location.siteName=window.location.siteName||function(a){var b,c;for(b=a||window.location.hostname,b=b.replace(/^\w+?:\d*?\/\//,""),b=b.split("/")[0],b=b.split("."),c=b.length>=2?2===b[b.length-2].length?3:2:1;b.length>c;)b.shift();return b.join(".")},void 0===String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),c=!!window.location.search.match("debug"),i=function(a){return c&&window.console&&window.console.log?window.console.log(a):void 0},m=function(a){return window._gaq.push(a),i(a)},m.help="Usage: track(['_trackEvent', category, action, opt_label, opt_value, opt_noninteraction])",h=!!document.location.protocol.match("https:"),g=!!document.location.protocol.match("http:"),j=document.documentElement,n=function(a,b,c){var d,f;return f=function(a){var d,e,f,g;for(e=b.nodeName||b===window||b===document?[b]:document.querySelectorAll(b),f=0,g=e.length;g>f;f++)if(d=e[f],a.currentTarget===d)return c.call(a.target,a)},d=b!==window?document:window,d.addEventListener?d.addEventListener(a,function(a){return f(a)},!1):d.attachEvent?(d.attachEvent("on"+a,function(){}),f(e)):void 0},b=function(a,b,c){var d;return j=document.documentElement,d=document.createElement("script"),"function"==typeof b&&n("load",d,b),d.src=a,d.async=void 0===c?!0:c,j.insertBefore(d,j.childNodes[0]),d},k={accountID:"UA-28236326-1",natGeoDomains:["nationalgeographicexpeditions.com","scienceblogs.com","buysub.com","ngtravelerseminars.com","greatenergychallengeblog.com","360energydiet.com","nationalgeographic.org","nationalgeographic.com","ngstudentexpeditions.com","natgeotakeaction.org","customersvc.com","killinglincolnconspiracy.com"],trackFirstNSearchItems:4,videoEvents:["canplay","playing","pause","progress","ended"],videoDurationMilestones:[0,25,50,75,100],scrollMilestones:[30,60,90]},d=function(a){var c,d,e,f,g,i,p,q,r,s,t,u,v,w,x,y,z,A,B;for(p in a)if("natGeoDomains"===p)for(A=a[p],y=0,z=A.length;z>y;y++)d=A[y],B=!d,o.call(k[p],B)>=0&&k[p].push(d);else k[p]=a[p];return window._gaq=window._gaq||[],m(["_setAccount",k.accountID]),m(["_setDomainName",l()]),m(["_setAllowLinker",!0]),m(["_addIgnoredRef","nationalgeographic"]),c=document.querySelectorAll("body"),"function"==typeof onMMDBHeaderLoaded&&onMMDBHeaderLoaded(function(a){return a.isLoggedIn().done(function(b){var c,d,e;return b?(d=a.getUser(),c=d.attributes.memberLevel,e=d.attributes.userHash,m(["_setCustomVar",3,"isLoged","true",3]),m(["_setCustomVar",8,"userToken",e,3]),m(["_setCustomVar",9,"memberLevel",c,3])):m(["_setCustomVar",3,"isLoged","false",3]),a.onUserLoggedIn(function(){return m(["_trackEvent","Membership","General","Sign In"])}),a.onUserLoggedOut(function(){return m(["_trackEvent","Membership","General","Log Out"])})})}),b(""+(h?"https://ssl":"http://www")+".google-analytics.com/ga.js"),n("click","a[href*='//']:not([href*='"+l()+"'])",function(a){var b,c;return b=a.target,c=l(b.href),o.call(k.natGeoDomains,c)>=0?m(["_link",b.href]):m(["_trackEvent","engagement","outbound-click",b.title||l(b.href)])}),c.on("click",".main-nav a, .global-nav a, .social-nav a, .main-nav button, .global-nav button, .social-nav button",function(){var a,b,c,d;return b=$(this),a=b.parents(".main-nav, .global-nav, .social-nav").eq(0),c=function(){return a.hasClass("social-nav")?"main-nav":a.hasClass(".global-nav")?"global-nav":"main-nav"}(),d=b.text().trim(),""===d&&(d=b.attr("title")),""===d&&(d=b.attr("id")),m(["_trackEvent","ngm-nav",c,d])}),r=-1,t=k.videoDurationMilestones,q=t[t.length-1],f=!1,c.on(k.videoEvents.join(" "),"video",function(a){var b,c,d,e,g,h,i,j,k,l,n,o;if(h=function(a){return m(["_trackEvent","video","Progress","Video complete "+a+"%"]),r=a},i=function(){return m(["_trackEvent","video","Start",k]),f=!0},"progress"===a.type){for(c=a.target.duration,b=a.target.currentTime,e=100*(b/c),o=[],l=0,n=t.length;n>l;l++)g=t[l],e>=g&&g>r&&o.push(h(g));return o}switch(k=a.target.title,d=k,a.type){case"playing"===a.type:j="Play";break;case"canplay"===a.type:j="Ready";break;case"ended"===a.type:j="Complete";break;default:j=a.type}return m(["_trackEvent","video",j,d]),"ended"===a.type&&r>q&&h(q),"play"!==a.type||f?void 0:i()}),c.on("click",".social-media-buttons a",function(a){var b;return b=a.target.title,"tweet"===b&&(b="twitter"),m(["_trackEvent","social","outbound-click",b])}),c.on("click",".search_results:nth-child(-n+"+k.trackFirstNSearchItems+") a",function(){var a;return a=$(this).index()+1,m(["_trackEvent","click","Search-NGM_"+a])}),u=function(){return window.self.pageYOffset||j&&j.scrollTop||document.body.scrollTop},s=function(){return document.body.scrollHeight},x=function(){return window.self.innerHeight||j&&j.clientHeight||document.body.clientHeight},v=k.scrollMilestones.slice(),i=function(){var a,b,c;for(c=[],a=0,b=v.length;b>a;a++)g=v[a],c.push(!1);return c}(),n("scroll",window,function(){var a,b,c,d,e,f,g,h,j,k,l;for(d=(u()+x())/s(),e=u(),c=window.location.pathname,f=window.location.search,h=c+f,g=function(a,b){return m(["_trackEvent","engagement","scrolled past "+b,h]),i[a]=!0},l=[],a=j=0,k=v.length;k>j;a=++j)b=v[a],!i[a]&&e>b?l.push(g(a,b)):l.push(void 0);return l}),e=20,w=window.location.pathname+window.location.search,window.setTimeout(function(){return m(["_trackEvent","engagement","Dwell time (more than "+e+" seconds)",w])},1e3*e)},a=function(){return k.accountID},f=function(){return k.natGeoDomains},window.Analytics=function(){function b(a){this.name=a.name,this.accountID=a.accountID,d()}return b.prototype.accountID=a,b.prototype.track=function(){return m(arguments[0].splice(1,""+this.name+"."+arguments[0]))},b.prototype.upon=n,b.prototype.internalTrafficDomains=f,b.prototype.videoEvents=[].slice.call(k.videoEvents),b}(),window.analytics=new Analytics({name:"cory"})}).call(this);