/**
 * NGS Module: analytics - v1.0.3
 * Description: Module for setting up Analytics on NGS projects
 * Date Built: 2014-07-07
 * Copyright (c) 2014  | National Geographic Society Technology;
**/
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};m=window.location.siteName=window.location.siteName||function(a){var b,c;for(b=a||window.location.hostname,b=b.replace(/^\w+?:\d*?\/\//,""),b=b.split("/")[0],b=b.split("."),c=b.length>=2?2===b[b.length-2].length?3:2:1;b.length>c;)b.shift();return b.join(".")},void 0===String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),d=!!window.location.search.match("debug"),j=function(a){return d&&window.console&&window.console.log?window.console.log(a):void 0},n=function(a){return window._gaq.push(a),j(a)},n.help="Usage: track(['_trackEvent', category, action, opt_label, opt_value, opt_noninteraction])",i=!!document.location.protocol.match("https:"),h=!!document.location.protocol.match("http:"),k=document.documentElement,e=function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},p=function(a,b,c){var d,e,f,g,h,i;if(b===window)d=[window];else if(b===document)d=[document];else try{d=document.querySelectorAll(b)}catch(j){e=j,d=""}for(i=[],g=0,h=d.length;h>g;g++)f=d[g],i.push(f.addEventListener?f.addEventListener(a,function(a){return c.call(a.target,a)},!1):d.attachEvent?f.attachEvent("on"+a,function(a){return c.call(a.target,a)}):void 0);return i},o=function(a,b){return window.addEventListener?window.addEventListener("hashchange",function(c){return location.hash===a?b.call(c.target,c):void 0}):window.attachEvent?window.attachEvent("on"+type,function(c){return location.hash===a?b.call(c.target,c):void 0}):void 0},c=function(a,b,c){var d;return k=document.documentElement,d=document.createElement("script"),"function"==typeof b&&p("load",d,b),d.src=a,d.async=void 0===c?!0:c,k.insertBefore(d,k.childNodes[0]),d},l={accountID:"UA-28236326-1",natGeoDomains:["nationalgeographicexpeditions.com","scienceblogs.com","buysub.com","ngtravelerseminars.com","greatenergychallengeblog.com","360energydiet.com","nationalgeographic.org","nationalgeographic.com","ngstudentexpeditions.com","natgeotakeaction.org","customersvc.com","killinglincolnconspiracy.com"],trackFirstNSearchItems:4,videoEvents:["canplay","playing","pause","progress","ended"],videoDurationMilestones:[0,25,50,75,100],scrollMilestones:[30,60,90]},f=function(a){var b,d,e,f,g,h,j,k,o,r,s;for(e in a)if("natGeoDomains"===e)for(r=a[e],k=0,o=r.length;o>k;k++)b=r[k],s=!b,q.call(l[e],s)>=0&&l[e].push(b);else l[e]=a[e];return window._gaq=window._gaq||[],n(["_setAccount",l.accountID]),n(["_setDomainName",m()]),n(["_setAllowLinker",!0]),n(["_addIgnoredRef","nationalgeographic"]),"function"==typeof onMMDBHeaderLoaded&&onMMDBHeaderLoaded(function(a){return a.isLoggedIn().done(function(b){var c,d,e;return b?(d=a.getUser(),c=d.attributes.memberLevel,e=d.attributes.userHash,n(["_setCustomVar",3,"isLoged","true",3]),n(["_setCustomVar",8,"userToken",e,3]),n(["_setCustomVar",9,"memberLevel",c,3])):n(["_setCustomVar",3,"isLoged","false",3]),a.onUserLoggedIn(function(){return n(["_trackEvent","Membership","General","Sign In"])}),a.onUserLoggedOut(function(){return n(["_trackEvent","Membership","General","Log Out"])})})}),j="//www.google-analytics.com/plugins/ga/inpage_linkid.js",window._gaq.push(["_require","inpage_linkid",j]),c(""+(i?"https://ssl":"http://www")+".google-analytics.com/ga.js"),p("click","a[href*='//']:not([href*='"+m()+"'])",function(a){var b,c;return b=a.target,c=m(b.href),n(q.call(l.natGeoDomains,c)>=0?["_link",b.href]:["_trackEvent","engagement","outbound-click",b.title||m(b.href)])}),g=-1,h=l.videoDurationMilestones,f=h[h.length-1],d=!1},b=function(){return l.accountID},g=function(){return l.natGeoDomains},a=function(){function a(a){var b;null==a&&(a={}),this.name=null!=(b=a.name)?b:"",f(a),this.settings=l}return a.prototype.track=n,a.prototype.upon=p,a.prototype.internalTrafficDomains=g,a.prototype.videoEvents=[].slice.call(l.videoEvents),a.prototype.trackHashChange=o,a}(),window.Analytics=a}).call(this);