/**
 * NGS Module: analytics - v1.0.4
 * Description: Module for setting up Analytics on NGS projects
 * Date Built: 2014-07-24
 * Copyright (c) 2014  | National Geographic Society Technology;
**/
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};m={accountID:"UA-28236326-1",version:"classic",natGeoDomains:["nationalgeographicexpeditions.com","scienceblogs.com","buysub.com","ngtravelerseminars.com","greatenergychallengeblog.com","360energydiet.com","nationalgeographic.org","nationalgeographic.com","ngstudentexpeditions.com","natgeotakeaction.org","customersvc.com","killinglincolnconspiracy.com"],trackFirstNSearchItems:4,videoEvents:["canplay","playing","pause","progress","ended"],videoDurationMilestones:[0,25,50,75,100],scrollMilestones:[30,60,90]},h="classic"===version,j=!!document.location.protocol.match("https:"),i=!!document.location.protocol.match("http:"),l=document.documentElement,n=window.location.siteName=window.location.siteName||function(a){var b,c;for(b=a||window.location.hostname,b=b.replace(/^\w+?:\d*?\/\//,""),b=b.split("/")[0],b=b.split("."),c=b.length>=2?2===b[b.length-2].length?3:2:1;b.length>c;)b.shift();return b.join(".")},d=!!window.location.search.match("debug"),k=function(a){return d&&window.console&&window.console.log?window.console.log(a):void 0},o=function(a){return h?(window._gaq.push(a),void k(a)):(window.ga(a),k(a))},e=function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},q=function(a,b,c){var d,e,f,g,h,i;if(b===window)d=[window];else if(b===document)d=[document];else try{d=document.querySelectorAll(b)}catch(j){e=j,d=""}for(i=[],g=0,h=d.length;h>g;g++)f=d[g],i.push(f.addEventListener?f.addEventListener(a,function(a){return c.call(a.target,a)},!1):d.attachEvent?f.attachEvent("on"+a,function(a){return c.call(a.target,a)}):void 0);return i},p=function(a,b){return window.addEventListener?window.addEventListener("hashchange",function(c){return location.hash===a?b.call(c.target,c):void 0}):window.attachEvent?window.attachEvent("on"+type,function(c){return location.hash===a?b.call(c.target,c):void 0}):void 0},c=function(a,b,c){var d;return l=document.documentElement,d=document.createElement("script"),"function"==typeof b&&q("load",d,b),d.src=a,d.async=void 0===c?!0:c,l.insertBefore(d,l.childNodes[0]),d},f=function(a){var b,d,e,f,g,i,k,l,p,s,t;for(e in a)if("natGeoDomains"===e)for(s=a[e],l=0,p=s.length;p>l;l++)b=s[l],t=!b,r.call(m[e],t)>=0&&m[e].push(b);else m[e]=a[e];return h?(window._gaq=window._gaq||[],o(["_setAccount",m.accountID]),o(["_setDomainName",n()]),o(["_setAllowLinker",!0]),o(["_addIgnoredRef","nationalgeographic"])):(window.ga=window.ga||[],window.ga("create",m.accoundID)),"function"==typeof onMMDBHeaderLoaded&&onMMDBHeaderLoaded(function(a){return a.isLoggedIn().done(function(b){var c,d,e,f;return b?(e=a.getUser(),d=e.attributes.memberLevel,f=e.attributes.userHash,h&&(o(["_setCustomVar",3,"isLoged","true",3]),o(["_setCustomVar",8,"userToken",f,3]),o(["_setCustomVar",9,"memberLevel",d,3]))):h&&o(["_setCustomVar",3,"isLoged","false",3]),c=["Membership","General"],a.onUserLoggedIn(function(){return h?o(["_trackEvent",c,"Sign In"]):o("send","event",c,"Sign In")}),a.onUserLoggedOut(function(){return h?o(["_trackEvent",c,"Log Out"]):o("send","event",c,"Log Out")})})}),k="//www.google-analytics.com/plugins/ga/inpage_linkid.js",h?window._gaq.push(["_require","inpage_linkid",k]):ga("require","inpage_linkid","inpage_linkid.js"),h&&"undefined"==typeof window._gaq&&null===window._gaq&&c(""+(j?"https://ssl":"http://www")+".google-analytics.com/ga.js"),q("click","a[href*='//']:not([href*='"+n()+"'])",function(a){var b,c,d;return c=a.target,d=n(c.href),r.call(m.natGeoDomains,d)>=0?o(["_link",c.href]):(b=c.title||n(c.href),h?o(["_trackEvent","engagement","outbound-click",b]):o("send","event","engagement","outboard-click",b))}),g=-1,i=m.videoDurationMilestones,f=i[i.length-1],d=!1},b=function(){return m.accountID},g=function(){return m.natGeoDomains},a=function(){function a(a){var b;null==a&&(a={}),this.name=null!=(b=a.name)?b:"",f(a),this.settings=m}return a.prototype.track=o,a.prototype.upon=q,a.prototype.internalTrafficDomains=g,a.prototype.videoEvents=[].slice.call(m.videoEvents),a.prototype.trackHashChange=p,a}(),window.Analytics=a}).call(this);